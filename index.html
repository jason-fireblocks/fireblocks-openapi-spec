<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fireblocks Data Objects</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: #0a0e17; min-height: 100vh; padding: 20px; }
    
    .fb-widget {
      font-family: system-ui, -apple-system, sans-serif;
      background: #0a0e17;
      color: #e1e5eb;
      max-width: 900px;
      margin: 0 auto;
    }
    .fb-title { font-size: 24px; font-weight: 600; margin-bottom: 20px; color: #fff; }
    .fb-search-box { position: relative; margin-bottom: 20px; }
    .fb-search {
      width: 100%;
      padding: 14px 18px;
      font-size: 15px;
      background: #141a26;
      border: 1px solid #2a3548;
      border-radius: 8px;
      color: #e1e5eb;
      outline: none;
    }
    .fb-search:focus { border-color: #00bcd4; }
    .fb-search::placeholder { color: #6b7a90; }
    .fb-info { font-size: 13px; color: #6b7a90; margin-bottom: 16px; }
    .fb-list { display: flex; flex-direction: column; gap: 8px; }
    .fb-item { background: #141a26; border: 1px solid #2a3548; border-radius: 8px; overflow: hidden; }
    .fb-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 18px;
      cursor: pointer;
    }
    .fb-header:hover { background: #1a2233; }
    .fb-name { font-weight: 600; font-size: 15px; color: #00bcd4; }
    .fb-badge { font-size: 11px; padding: 2px 8px; border-radius: 4px; margin-left: 10px; }
    .fb-badge-enum { background: rgba(167,139,250,0.15); color: #a78bfa; }
    .fb-badge-array { background: rgba(52,211,153,0.15); color: #34d399; }
    .fb-body { display: none; padding: 16px 18px; border-top: 1px solid #2a3548; }
    .fb-desc { font-size: 14px; color: #9aa5b5; margin-bottom: 16px; line-height: 1.5; }
    .fb-props-title { font-size: 12px; font-weight: 600; text-transform: uppercase; color: #6b7a90; margin-bottom: 12px; }
    .fb-prop { padding: 10px 12px; background: #0d1219; border-radius: 6px; margin-bottom: 6px; }
    .fb-prop-row { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    .fb-prop-name { font-family: monospace; font-size: 13px; color: #f8b500; }
    .fb-prop-type { font-family: monospace; font-size: 12px; color: #00bcd4; background: rgba(0,188,212,0.1); padding: 2px 8px; border-radius: 4px; }
    .fb-prop-req { font-size: 11px; color: #ff6b6b; font-weight: 600; }
    .fb-prop-dep { font-size: 11px; color: #f59e0b; font-weight: 600; }
    .fb-prop-desc { font-size: 13px; color: #9aa5b5; margin-top: 6px; line-height: 1.4; }
    .fb-empty { text-align: center; padding: 40px 20px; color: #6b7a90; }
    .fb-loading { text-align: center; padding: 60px 20px; color: #6b7a90; }
    .fb-error { text-align: center; padding: 40px 20px; color: #ff6b6b; }
    .fb-enum-box { margin-top: 8px; padding: 8px 10px; background: #141a26; border-radius: 4px; }
    .fb-enum-label { font-size: 11px; color: #6b7a90; margin-bottom: 6px; }
    .fb-enum-list { display: flex; flex-wrap: wrap; gap: 6px; }
    .fb-enum-val { font-family: monospace; font-size: 12px; color: #a78bfa; background: rgba(167,139,250,0.1); padding: 2px 8px; border-radius: 4px; }
    .fb-spinner { 
      width: 32px; height: 32px; 
      border: 3px solid #2a3548; 
      border-top-color: #00bcd4; 
      border-radius: 50%; 
      animation: spin 0.8s linear infinite; 
      margin: 0 auto 16px; 
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="fb-widget">
    <div class="fb-title">Data Objects Reference</div>
    <div class="fb-search-box">
      <input type="text" class="fb-search" id="fbSearch" placeholder="Search data objects...">
    </div>
    <div id="fbInfo" class="fb-info"></div>
    <div id="fbList" class="fb-list">
      <div class="fb-loading">
        <div class="fb-spinner"></div>
        <div>Loading schemas...</div>
      </div>
    </div>
  </div>

  <script>
    var SPEC_URL = "https://raw.githubusercontent.com/jason-fireblocks/fireblocks-openapi-spec/main/openapi.json";
    var allSchemas = [];
    
    window.fbToggle = function(id) {
      var body = document.getElementById("body_" + id);
      if (body) {
        body.style.display = body.style.display === "block" ? "none" : "block";
      }
    };

    function extractSchemas(spec) {
      var schemas = {};
      var source = null;
      
      // OpenAPI 3.x: components.schemas
      if (spec.components && spec.components.schemas) {
        source = spec.components.schemas;
      }
      // Swagger 2.x: definitions
      else if (spec.definitions) {
        source = spec.definitions;
      }
      
      if (!source) return schemas;
      
      var names = Object.keys(source);
      for (var i = 0; i < names.length; i++) {
        var name = names[i];
        var s = source[name];
        schemas[name] = {
          name: name,
          type: s.type || "object",
          description: s.description || "",
          properties: s.properties || {},
          required: s.required || [],
          enum: s["enum"] || null
        };
      }
      
      return schemas;
    }

    function loadSchemas() {
      fetch(SPEC_URL)
        .then(function(res) {
          if (!res.ok) throw new Error("Failed to fetch: " + res.status);
          return res.json();
        })
        .then(function(data) {
          var schemas = extractSchemas(data);
          
          allSchemas = [];
          var names = Object.keys(schemas);
          for (var i = 0; i < names.length; i++) {
            allSchemas.push(schemas[names[i]]);
          }
          allSchemas.sort(function(a, b) { return a.name.localeCompare(b.name); });
          
          render(allSchemas);
          showInfo(allSchemas.length, allSchemas.length);
        })
        .catch(function(err) {
          document.getElementById("fbList").innerHTML = '<div class="fb-error">Failed to load schemas: ' + err.message + '</div>';
        });
    }
    
    function showInfo(shown, total) {
      document.getElementById("fbInfo").textContent = (shown === total) ? total + " data objects" : "Showing " + shown + " of " + total;
    }
    
    function render(list) {
      var out = "";
      if (list.length === 0) {
        out = '<div class="fb-empty">No matching schemas found</div>';
      } else {
        for (var i = 0; i < list.length; i++) {
          var s = list[i];
          var isEnum = s["enum"] ? true : false;
          var isArray = s.type === "array";
          var props = s.properties || {};
          var req = s.required || [];
          var pnames = Object.keys(props);
          
          out += '<div class="fb-item">';
          out += '<div class="fb-header" onclick="fbToggle(' + i + ')">';
          out += '<span class="fb-name">' + s.name;
          if (isEnum) out += '<span class="fb-badge fb-badge-enum">enum</span>';
          if (isArray) out += '<span class="fb-badge fb-badge-array">array</span>';
          out += '</span><span>&#9660;</span></div>';
          out += '<div class="fb-body" id="body_' + i + '">';
          
          if (s.description) out += '<div class="fb-desc">' + s.description + '</div>';
          
          if (isEnum && s["enum"]) {
            out += '<div class="fb-enum-box"><div class="fb-enum-label">Possible values:</div><div class="fb-enum-list">';
            for (var e = 0; e < s["enum"].length; e++) {
              out += '<span class="fb-enum-val">' + s["enum"][e] + '</span>';
            }
            out += '</div></div>';
          } else if (pnames.length > 0) {
            out += '<div class="fb-props-title">Properties</div>';
            for (var j = 0; j < pnames.length; j++) {
              var pn = pnames[j];
              var p = props[pn];
              var isReq = req.indexOf(pn) > -1;
              var pType = p.type || "object";
              if (p["x-readme-ref-name"]) pType = p["x-readme-ref-name"];
              if (p.type === "array" && p.items) {
                pType = (p.items["x-readme-ref-name"] || p.items.type || "any") + "[]";
              }
              
              out += '<div class="fb-prop"><div class="fb-prop-row">';
              out += '<span class="fb-prop-name">' + pn + '</span>';
              out += '<span class="fb-prop-type">' + pType + '</span>';
              if (isReq) out += '<span class="fb-prop-req">required</span>';
              if (p.deprecated) out += '<span class="fb-prop-dep">deprecated</span>';
              out += '</div>';
              if (p.description) out += '<div class="fb-prop-desc">' + p.description + '</div>';
              if (p["enum"]) {
                out += '<div class="fb-enum-box"><div class="fb-enum-label">Possible values:</div><div class="fb-enum-list">';
                for (var ev = 0; ev < p["enum"].length; ev++) {
                  out += '<span class="fb-enum-val">' + p["enum"][ev] + '</span>';
                }
                out += '</div></div>';
              }
              out += '</div>';
            }
          } else {
            out += '<div class="fb-empty">No properties defined</div>';
          }
          out += '</div></div>';
        }
      }
      document.getElementById("fbList").innerHTML = out;
    }
    
    function doSearch(q) {
      if (!q) {
        render(allSchemas);
        showInfo(allSchemas.length, allSchemas.length);
        return;
      }
      var res = [];
      for (var i = 0; i < allSchemas.length; i++) {
        var s = allSchemas[i];
        var nm = s.name.toLowerCase().indexOf(q) > -1;
        var dm = s.description && s.description.toLowerCase().indexOf(q) > -1;
        var pm = false;
        if (s.properties) {
          var pk = Object.keys(s.properties);
          for (var j = 0; j < pk.length; j++) {
            if (pk[j].toLowerCase().indexOf(q) > -1) { pm = true; break; }
          }
        }
        if (nm || dm || pm) res.push(s);
      }
      render(res);
      showInfo(res.length, allSchemas.length);
    }
    
    document.getElementById("fbSearch").onkeyup = function() {
      doSearch(this.value.toLowerCase().trim());
    };
    
    loadSchemas();
  </script>
</body>
</html>
